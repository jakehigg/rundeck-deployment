//# sourceMappingURL=workflow.test.js.map
function _wfTypeForStep(a){if("undefined"!=typeof a){if(a.exec)return"command";if(a.jobref)return"job";if(a.script)return"script";if(a.scriptfile)return"scriptfile";if(a.scripturl)return"scripturl";if(a.type)return a.nodeStep?"node-step-plugin plugin":null==a.nodeStep||a.nodeStep?"plugin":"workflow-step-plugin plugin"}return"console"}
function _wfStringForStep(a){var b="";if("undefined"!=typeof a)a.description?b=a.description:a.exec?b="Command":a.jobref?b=(a.jobref.group?a.jobref.group+"/":"")+a.jobref.name:a.script?b="Script":a.scriptfile?b="File":a.scripturl?b="URL":a.type&&(b="Plugin "+a.type,a.nodeStep&&RDWorkflow.nodeSteppluginDescriptions&&RDWorkflow.nodeSteppluginDescriptions[a.type]?b=RDWorkflow.nodeSteppluginDescriptions[a.type].title||b:!a.nodeStep&&RDWorkflow.wfSteppluginDescriptions&&RDWorkflow.wfSteppluginDescriptions[a.type]&&
(b=RDWorkflow.wfSteppluginDescriptions[a.type].title||b));else return"[?]";return b}
var RDWorkflow=Class.create({workflow:null,initialize:function(a,b){this.workflow=a;Object.extend(this,b)},contextType:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];return _wfTypeForStep(a)},renderContextStepNumber:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));a=""+RDWorkflow.stepNumberForContextId(a[0]);return a+". "},renderContextString:function(a){"string"==typeof a&&(a=RDWorkflow.parseContextId(a));
a=this.workflow[RDWorkflow.workflowIndexForContextId(a[0])];return _wfStringForStep(a)}});RDWorkflow.unescape=function(a,b,c,f){for(var g=[],e=!1,h=0,l=null;h<a.length;h++){var k=a.charAt(h);if(k==b)e?(g.push(b),e=!1):e=!0;else if(0<=c.indexOf(k))if(e)g.push(k),e=!1;else if(0<=f.indexOf(k)){l=k;break}else g.push(k);else e&&(g.push(b),e=!1),g.push(k)}return{text:g.join(""),bchar:l,rest:h<=a.length-1?a.substring(h+1):null}};
RDWorkflow.splitEscaped=function(a,b){for(var c=[],f=a;f;)f=RDWorkflow.unescape(f,"\\",["\\","/"],[b]),c.push(f.text),f=f.rest;return c};RDWorkflow.contextStringSeparator="/";RDWorkflow.parseContextId=function(a){return null==a?null:RDWorkflow.splitEscaped(a,RDWorkflow.contextStringSeparator).slice()};RDWorkflow.paramsForContextId=function(a){a=a.match(/^(\d+)(e)?(@(.+))?$/);return a[4]?a[4].replace(/\\([/@,=])/g,"$1"):null};
RDWorkflow.isErrorhandlerForContextId=function(a){return"e"==a.match(/^(\d+)(e)?(@.+)?$/)[2]?!0:!1};RDWorkflow.stepNumberForContextId=function(a){a=a.match(/^(\d+)(e)?(@.+)?$/);return a[1]?parseInt(a[1]):null};RDWorkflow.workflowIndexForContextId=function(a){a=RDWorkflow.stepNumberForContextId(a);return null!=a?a-1:null};RDWorkflow.cleanContextId=function(a){a=RDWorkflow.parseContextId(a);for(var b=0;b<a.length;b++)a[b]=RDWorkflow.stepNumberForContextId(a[b]);return a.join(RDWorkflow.contextStringSeparator)};
var TestHarness=function(a,b){var c=this;c.name=a;var f=0,g=0,e="js_test_"+Math.floor(1024*Math.random()),h="";c.compare=function(a,b){if(typeof a!=typeof b||null==a&&null!=b||null!=a&&null==b)return!1;if(null!=a&&null!=b&&"array"==jQuery.type(a)&&"array"==jQuery.type(b)){if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(!c.compare(a[d],b[d]))return!1;return!0}if(null!=a&&null!=b&&"object"==typeof a){if(Object.keys(a).length!=Object.keys(b).length)return!1;for(d in a)if(!c.compare(a[d],
b[d]))return!1;for(d in b)if(!c.compare(a[d],b[d]))return!1;return!0}return a===b};c.error=function(a){jQuery("#"+e).append(jQuery('<div class="js-test-failure"></div>').append(jQuery('<span class="text-danger"></span>').text(a)))};c.ok=function(a){jQuery("#"+e).append(jQuery("<div></div>").append(jQuery('<span class="text-success"></span>').text("OK: "+a)))};c.assert=function(a,b,d){g++;null==b&&null==d&&"string"!=typeof a?(b=!0,d=a,a="(assert)"):null==d&&"string"==typeof b&&"boolean"==typeof a&&
(d=a,a=b,b=!0);if(c.compare(b,d))c.ok(h+a);else{f++;a="FAIL: "+h+a+": expected: "+JSON.stringify(b)+", was: "+JSON.stringify(d);c.error(a);try{throw Error("assert failed: "+a);}catch(e){console.log(e,e.stack)}}};c.log=function(a,b){jQuery("#"+e).append(jQuery("<div></div>").append(jQuery('<span class="text-info"></span>').text("LOG: "+a)));b&&jQuery("#"+e).append(jQuery("<div></div>").append(jQuery('<span class="text-info"></span>').text(b)))};c.testMatrix=function(a,b,d){b.forEach(function(b){var e=
d(b[0]);c.assert(messageTemplate(a,[JSON.stringify(b[0]),JSON.stringify(b[1])]),b[1],e)})};c.holder={};c.prepare=function(){if("object"==typeof window.Messages){c.holder.Messages=Messages;var a={},b;for(b in Messages)a[b]=b;window.Messages=a}};c.restore=function(){window.Messages=c.holder.Messages;c.holder={}};c.testAll=function(){c.prepare();jQuery(document.body).append(jQuery('<div id="'+e+'" class="collapse in"></div>'));var a=jQuery("#"+e);c.log("Start: "+c.name);for(var b in c)if(b.endsWith("Test"))try{h=
b+": ",c[b].call(c,b+": ")}catch(d){c.assert("caught error running test: "+d,"ok","exception"),console.log("error",d,d.stack)}h="";0<f?a.prepend(jQuery("<div></div>").append(jQuery('<span class="text-danger"></span>').text("FAIL: "+f+"/"+g+" assertions failed"))):(a.collapse("hide"),jQuery(document.body).append("<div></div>").append('<span class="btn btn-link text-success" data-toggle="collapse" data-target="#'+e+'">OK: '+g+" Tests Passed</span>"));c.restore()};for(var l in b)c[l]=b[l].bind(c);jQuery(function(){c.testAll()})};
jQuery(function(){new TestHarness("workflow.test.js",{workflowTest:function(){this.assert("unescape",RDWorkflow.unescape("abc/123","\\",["\\","/"],["/"]),{text:"abc",bchar:"/",rest:"123"});this.assert("unescape",RDWorkflow.unescape("abc/123/456","\\",["\\","/"],["/"]),{text:"abc",bchar:"/",rest:"123/456"});this.assert("unescape",RDWorkflow.unescape("a\\/bc/123/456","\\",["\\","/"],["/"]),{text:"a/bc",bchar:"/",rest:"123/456"})},splitEscapedTest:function(){this.assert("splitEscaped",RDWorkflow.splitEscaped("a\\/bc/123/456",
"/"),["a/bc","123","456"]);this.assert("splitEscaped",RDWorkflow.splitEscaped("a\\/b@c/1,2=3/4\\\\56","/"),["a/b@c","1,2=3","4\\56"])},isErrorhandlerForContextIdTest:function(){this.assert(!0===RDWorkflow.isErrorhandlerForContextId("1e@blah=c"));this.assert(!1===RDWorkflow.isErrorhandlerForContextId("2"));this.assert(!1===RDWorkflow.isErrorhandlerForContextId("2@node=a"));this.assert(!0===RDWorkflow.isErrorhandlerForContextId("2e"));this.assert(!0===RDWorkflow.isErrorhandlerForContextId("2e@blah=c"))},
paramsForContextIdTest:function(){this.assert(null===RDWorkflow.paramsForContextId("2"));this.assert("node=a"===RDWorkflow.paramsForContextId("2@node=a"));this.assert("node=a"===RDWorkflow.paramsForContextId("2@node\\=a"));this.assert(null===RDWorkflow.paramsForContextId("2e"));this.assert("blah=c"===RDWorkflow.paramsForContextId("2e@blah=c"))},stepNumberForContextIdTest:function(){this.assert(1===RDWorkflow.stepNumberForContextId("1e@blah=c"));this.assert(2===RDWorkflow.stepNumberForContextId("2"));
this.assert(2===RDWorkflow.stepNumberForContextId("2@node=a"));this.assert(2===RDWorkflow.stepNumberForContextId("2e"));this.assert(2===RDWorkflow.stepNumberForContextId("2e@blah=c"))},workflowIndexForContextIdTest:function(){this.assert(0===RDWorkflow.workflowIndexForContextId("1e@blah=c"));this.assert(1===RDWorkflow.workflowIndexForContextId("2"));this.assert(1===RDWorkflow.workflowIndexForContextId("2@node=a"));this.assert(1===RDWorkflow.workflowIndexForContextId("2e"));this.assert(1===RDWorkflow.workflowIndexForContextId("2e@blah=c"))},
parseContextIdTest:function(){this.assert("parseContextId",RDWorkflow.parseContextId("1"),["1"]);this.assert("parseContextId",RDWorkflow.parseContextId("1/1"),["1","1"]);this.assert("parseContextId",RDWorkflow.parseContextId("1/1/1"),["1","1","1"]);this.assert("parseContextId",RDWorkflow.parseContextId("1/2/3"),["1","2","3"]);this.assert("parseContextId",RDWorkflow.parseContextId("1e@abc/2/3"),["1e@abc","2","3"]);this.assert("parseContextId",RDWorkflow.parseContextId("1/2e@asdf=xyz/3"),["1","2e@asdf=xyz",
"3"]);this.assert("parseContextId",RDWorkflow.parseContextId("2@node=crub\\/dub-1/1"),["2@node=crub/dub-1","1"])},cleanContextIdTest:function(){this.assert("1/2/3"===RDWorkflow.cleanContextId("1/2/3"),"wrong value");this.assert("1/2/3"===RDWorkflow.cleanContextId("1e@abc/2/3"),"wrong value");this.assert("1/2/3"===RDWorkflow.cleanContextId("1/2e@asdf=xyz/3"),"wrong value")},stepPluginDescriptionsTest:function(){var a=RDWorkflow.nodeSteppluginDescriptions;RDWorkflow.nodeSteppluginDescriptions={};RDWorkflow.wfSteppluginDescriptions=
{};RDWorkflow.nodeSteppluginDescriptions={"example-node-step":{title:"blah"}};var b=new RDWorkflow([{type:"example-node-step",nodeStep:!0,configuration:{example:"whatever"}}]);this.assert("blah"===b.renderContextString("1"));RDWorkflow.wfSteppluginDescriptions={"example-node-step":{title:"blah"}};b=new RDWorkflow([{type:"example-node-step",nodeStep:!1,configuration:{example:"whatever"}}]);this.assert("blah"===b.renderContextString("1"));RDWorkflow.nodeSteppluginDescriptions={};RDWorkflow.wfSteppluginDescriptions=
{};b=new RDWorkflow([{type:"example-node-step",nodeStep:!0,configuration:{example:"whatever"}}]);this.assert("Plugin example-node-step"===b.renderContextString("1"));b=new RDWorkflow([{type:"example-node-step",nodeStep:!1,configuration:{example:"whatever"}}]);this.assert("Plugin example-node-step"===b.renderContextString("1"));RDWorkflow.nodeSteppluginDescriptions=a;RDWorkflow.wfSteppluginDescriptions=a}})});